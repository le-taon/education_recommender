<!DOCTYPE html>

<head>
	<!-- Vue.js CDN -->
	<script src="https://cdn.jsdelivr.net/npm/vue@2.6.10/dist/vue.js"></script>

	<!-- UIkit CSS -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.1.6/css/uikit.min.css" />

	<!-- UIkit JS -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.1.6/js/uikit.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.1.6/js/uikit-icons.min.js"></script>

	<!-- Custom CSS -->
	<link rel="stylesheet" type="text/css" href="src/style.css">

	<!-- JQuery JS -->
	<script
	    src="https://code.jquery.com/jquery-3.4.1.min.js"
	    integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
	    crossorigin="anonymous">
	</script>

</head>

<body>
	<div id="recommender-app" class="uk-container">
		<div class="uk-grid uk-child-width-1-2">
			<div>	
				<h3>Когда будут занятия</h3>
				<div class="uk-grid uk-child-width-1-2">
					<form class="uk-form">
					    <input 
					    	type="text" 
					    	data-uk-datepicker="{format:'DD.MM.YYYY'}"
					    	placeholder="С какого числа">
					</form>
					<form class="uk-form">
					    <input 
					    	type="text" 
					    	data-uk-datepicker="{format:'DD.MM.YYYY'}"
					    	placeholder="По какое число">
					</form>
				</div>
			</div>
			<div>
				<h3>Предмет</h3>
				<ul id="my-id" class="uk-subnav uk-subnav-pill">
				    <li data-uk-filter="phisics" class="uk-active">Физика</li>
				    <li data-uk-filter="math">Математика</li>
				</ul>
			</div>
		</div>
		
		<h3>Что нужно выучить</h2>
		<div class="material-list uk-grid uk-child-width-1-4@m">
			<material
				v-for="material in materialList"	
			    v-bind:key="material.id"
				v-bind:material="material">
			</material>
		</div>
	</div>
	<script type="text/javascript">
		Vue.component('material', {
			props: ['material'],
			data: function () {
				return {
					imageSource: 'https://uchebnik.mos.ru/' + this.material.cover
				}
			},
			computed: {
				link: function () {
					let type_ref = this.material.material_type.replace(/([a-z])([A-Z])/g, '$1_$2'); 
					return `https://uchebnik.mos.ru/catalogue/material_view/${ type_ref }/${ this.material.material_id }`
				},
				total_votes: function () {
					let votes = this.material.user_votes;
					let total_votes = 0;

					for (prop in votes) {
						total_votes += votes[prop];
					}

					return total_votes;
				}
			},
			template: `
				<div> 
					<a class="uk-link-toggle" v-bind:href="link">
						<div class="uk-card uk-card-default uk-card-hover uk-card-small material-card"> 
							<div class="uk-card-media-top card-image"> 
								<img v-bind:src="imageSource"> 
								</div> 
							<div class="uk-card-body"> 
								<h3 class="uk-card-title uk-link-heading">{{ material.name }}</h3> 
								<p>{{material.description }}</p> 
							</div> 
						</div>
					</a> 
				</div>
				`
			}
		)



		fetch('http://digitalhack.bakhuss.ru/materials?pageSize=7&page=132')
			.then(
				function(response) {
				    return response.json();
			})
			.then(
				function (materials) {
					materials = materials.sort((a, b) => {
							if (a.average_rating > b.average_rating) {
								return -1;
							} else if (a.average_rating == b.average_rating) {
								return 0;
							} else {
								return 1;
							}
						}
					)

					vm = new Vue({
						el: '#recommender-app',
						data: {
							materialList: materials
						}
					})
				}
			)
		
	</script>
</body>
